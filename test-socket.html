<!DOCTYPE html>
<html>
<head>
    <title>Socket Test</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket Test</h1>
    <button onclick="testDelete()">Test Delete Event</button>
    <div id="log"></div>

    <script>
        const socket = io('http://localhost:3001');
        const log = document.getElementById('log');

        function addLog(message) {
            log.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
        }

        socket.on('connect', () => {
            addLog('âœ… Connected to socket server');
        });

        socket.on('task.deleted', (data) => {
            addLog('ðŸ—‘ï¸ Received task.deleted: ' + JSON.stringify(data));
        });

        function testDelete() {
            fetch('http://localhost:3001/webhook/task-event', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    event: 'task.deleted',
                    data: { task: { id: 999, title: 'Test Task' } }
                })
            }).then(() => {
                addLog('ðŸ“¡ Sent test delete event');
            });
        }
    </script>
</body>
</html>